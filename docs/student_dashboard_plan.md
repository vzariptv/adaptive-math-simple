# Student Dashboard Plan

Дата: 2025-08-20 23:23
Ответственный: Виктория / Cascade

## Цели
- Привести интерфейс студента к единому стилю (Bootstrap, общая `shared/base.html`).
- Реализовать 2 раздела: «Задачи» и «Профиль и прогресс».
- Обеспечить корректную работу эндпоинтов, фильтров и форм.

## Текущая архитектура
- Блюпринт: `blueprints/student/routes.py` (`student_bp`, url_prefix: `/student`).
  - `GET /student/tasks` → endpoint: `student.tasks`
  - `GET|POST /student/profile` → endpoint: `student.profile`
- Формы: `blueprints/student/forms.py`
  - `UpdateProfileForm`
  - `ChangePasswordForm`
- Шаблоны:
  - `templates/student/dashboard.html` (навбар и общий контент-блок)
  - `templates/student/tasks.html` (фильтр по теме, таблица задач с 0/3, статус)
  - `templates/student/profile.html` (редактирование профиля, смена пароля, изучаемые темы)
- База: `templates/shared/base.html`

## Бэклог задач
- [x] Задачи: добавить пагинацию списка задач (20 задач на страницу)
- [x] Задачи: фильтр по статусу (решено/ожидает)
- [x] Задачи: действие «Выбрать» — роут на экран решения. Студент должен иметь возможность просмотреть условие задачи, уровень задачи, количество попыток, свой лог по попыткам с ответами и ввести решение в форме соответствующей типу решения (см. как это сделано у админа). Студент должен иметь возможность отправить решение на проверку и в случае если его ответ совпадает с заданным ответом полностью получить максимальный возможный балл по задаче, иначе 0. После третьей попытки задача блокируется. Со второй попытки студент должен иметь возможность запросить подсказку и просмотреть ее. Если задача уже решена то переход на карточку задачи просто дает возможность просмотреть информацию по задаче и лог попытков ее решения с ответами и все, никаких дополнительных кнопок.
- [x] Задачи: добавить статус заблокирована (иконка выставляется если задача уже имеет три неудачных попытки и не решена). При этом блокируется возможность перейти на карточку задачи.
- [x] Задачи: сортировать так чтобы решенные задачи были в начале, затем задачи с наибольшим количеством попыток, далее все остальные по дате создания
- [ ] Профиль: модальное окно/страница «Подробнее» со статистикой (прошлая и текущая неделя) — графики как у админа
- [ ] Профиль: сделать страницу основной при переходе на дашборд
- [ ] Общие: авто-активация пункта меню по `request.endpoint` (сделано для 2 пунктов, проверить на всех экранах)
- [ ] Тесты (pytest): покрыть новые эндпоинты (авторизация студента, фильтрация задач, обновление профиля, смена пароля)
- [ ] E2E тесты на неверные ответы и блокировки для типов variables/interval/sequence (сейчас глубже покрыт number).

### Низкий приоритет, отложено до 2.0
- [ ] Профиль: улучшить UX валидации e-mail (подсветка ошибок)
- [ ] Профиль: добавить возможность добавления темы в изучаемые

## Лог изменений
- 2025-08-21 00:51 — Реализована сортировка списка задач:
  - Критерии: решенные первыми; затем по количеству попыток (убывание); затем по дате создания задачи (убывание).
  - Реализация: `blueprints/student/routes.py::tasks()` после агрегации `tasks_data`.
- 2025-08-21 00:50 — Статус «заблокирована» и запрет перехода на карточку:
  - Подсчет `incorrect_cnt` и вычисление `blocked = incorrect_cnt >= 3 and not solved` на сервере (`student.tasks`, `view_task`).
  - В списке задач (`templates/student/tasks.html`) показана иконка замка и кнопка «Выбрать» задизейблена для заблокированных.
  - Серверная защита: `view_task()` при GET редиректит со всплывающим сообщением, если задача заблокирована и не решена.
- 2025-08-21 00:49 — Реализован экран решения задачи для студента и связанный флоу:
  - Экран `student.view_task` показывает условие, уровень, счетчик попыток и лог попыток с ответами.
  - Формы ответов приведены к канону админки: number (`answer`), variables (фиксированные имена из `correct_answer`, без добавления/удаления), sequence (`sequence_input`), interval (`start`/`end` + `start_inclusive`/`end_inclusive`).
  - Проверка ответа: полный матч — максимальный балл, иначе 0; хранится `TaskAttempt` с JSON-ответом.
  - Блокировка после 3 неуспешных попыток; со 2-й попытки доступна подсказка.
  - Если задача решена — карточка read-only: можно просмотреть условие и лог, без кнопок и форм.
  - Обновлены: `templates/student/task_view.html`, `blueprints/student/routes.py` (канонизация ответов, сравнение, подсказки/блокировка).
- 2025-08-20 23:25 — Добавлены фильтр по статусу (решено/ожидает) и пагинация (20 на страницу) на странице задач студента. Обновлены: `blueprints/student/routes.py`, `templates/student/tasks.html`.
## Выполнено
- [x] Создан блюпринт `student` и зарегистрирован в `app.py`
- [x] `student.tasks`: список задач по выбранной теме и уровню студента (если прогресса нет — уровень `low`)
- [x] Подсчет попыток и статуса задачи (N/3, иконки «решено»/«ожидает»)
- [x] `student.profile`: формы обновления профиля и смены пароля, список изучаемых тем
- [x] Шаблоны переведены на наследование от `shared/base.html` через `student/dashboard.html`

## Важные замечания
- Лимит задач по теме берется из `TopicLevelConfig.task_count_threshold`; если нет — дефолт 10.
- Статус «решено» определяется фактом наличия успешной попытки по задаче.
- Кнопка «Выбрать» в задачах пока без действия — потребуется согласовать целевой флоу.
 - Экран решения: 
   - Блокировка после 3 неудачных попыток, кнопки и форма недоступны.
   - Подсказка становится доступна начиная со 2-й попытки.
   - Для типа «Переменные» студент видит фиксированный набор имен из `correct_answer`, имена не редактируются и количество строк фиксировано.
   - Канонизация ответов на сервере обеспечивает сравнение старых и новых форматов `correct_answer`.

## Решения/выборы дизайна
- Маршруты студента отделены от общих роутов задач для более явного разграничения ролей.
- Шаблоны студента наследуют единый `dashboard.html`, чтобы минимизировать дублирование.

## Ссылки на ключевые файлы
- `blueprints/student/routes.py`
- `blueprints/student/forms.py`
- `templates/student/dashboard.html`
- `templates/student/tasks.html`
- `templates/student/profile.html`
